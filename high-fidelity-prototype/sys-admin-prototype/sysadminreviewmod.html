<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <style>
        body {
            overflow-x: hidden;
        }
        .navbar {
            .dropdown-menu {
                position:absolute;
                justify-content: end;
            }
        }
        .card {
            border: none;
            .card-body {
                .botton {
                    word-wrap: break-word;
                }
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar bg-dark boarder-bottom border-3 border-secondary" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/high-fidelity-prototype/provider-prototype/dmhome.html">
                <img src="/high-fidelity-prototype/images/d20OutlineWhite.PNG" alt="Nat20 Network" width="30" height="auto" class="d-inline-block align-text-top">
            Nat20 Network
            </a>
            <ul class="navbar-nav justify-content-center">
                <ul class="nav justify-content-left">
                    <li class="nav-item align-middle">
                        <a class="nav-link" href="/high-fidelity-prototype/tools.html">Tools</a>
                    </li>
                    <li class="nav-item align-middle">
                        <a class="nav-link" href="campaignrequests.html">View Requests</a>
                    </li>
                    <li class="nav-item dropdown-center">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Profile
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                            <li><a class="dropdown-item" href="manageprofile.html">Manage profile</a></li>
                            <li><a class="dropdown-item" href="dmhome.html">Home</a></li>
                            <li><a class="dropdown-item" href="playerfeedback.html">See reviews</a></li>
                            <li><a class="dropdown-item" href="/high-fidelity-prototype/home.html">Log Out</a></li>
                        </ul>
                    </li>
                </ul>
            </ul>
        </div>
    </nav>

      <div class="container">
    <header class="d-flex align-items-center mb-4">
      <img src="/high-fidelity-prototype/images/d20OutlineWhite.PNG" alt="logo" width="36" class="me-2">
      <h4 class="mb-0">Moderate Reviews — Demo</h4>
      <small class="text-muted ms-3">fabricated examples</small>
    </header>

    <!-- Reported Reviews -->
    <section class="mb-4">
      <div class="card card-compact shadow-sm">
        <div class="card-body">
          <h5 class="mb-3">Reported Reviews (5 examples)</h5>
          <div class="list-group" id="reportedReviews">
            <!-- items populated by JS -->
          </div>
          <div class="mt-3">
            <small class="muted-note">Actions: Dismiss report, Mark as resolved, Remove review.</small>
          </div>
        </div>
      </div>
    </section>

     <!-- Offensive / Fraudulent Content -->
    <section class="mb-4">
      <div class="card card-compact shadow-sm">
        <div class="card-body">
          <h5 class="mb-3">Remove Offensive or Fraudulent Content (5 examples)</h5>
          <div class="list-group" id="offensiveFraudList"></div>
          <div class="mt-3">
            <small class="muted-note">Some entries are rude/offensive (non-hateful) and others are suspicious/fraudulent. Use Remove to take content down.</small>
          </div>
        </div>
      </div>
    </section>

    <!-- Mediate Disputes -->
    <section class="mb-4">
      <div class="card card-compact shadow-sm">
        <div class="card-body">
          <h5 class="mb-3">Mediate Disputes (5 examples)</h5>
          <div class="list-group" id="disputeList"></div>
          <div class="mt-3">
            <small class="muted-note">Open a dispute to view conversation and mark outcome.</small>
          </div>
        </div>
      </div>
    </section>

    <footer class="text-muted small">Demo only — integrate with backend to persist actions.</footer>
  </div>

  <!-- Mediation modal -->
  <div class="modal fade" id="mediateModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Mediate Dispute</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="mediationTranscript" class="mb-3" style="max-height:300px; overflow:auto; white-space:pre-wrap; background:#f8f9fa; padding:.75rem; border-radius:.25rem;"></div>
          <label class="form-label">Outcome</label>
          <select id="mediationOutcome" class="form-select mb-2">
            <option value="no-action">No action needed</option>
            <option value="warning">Issue warning to user</option>
            <option value="remove-review">Remove review</option>
            <option value="suspend">Suspend user</option>
          </select>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="notifyParties">
            <label class="form-check-label" for="notifyParties">Notify parties of outcome</label>
          </div>
        </div>
        <div class="modal-footer">
          <button id="mediateResolveBtn" type="button" class="btn btn-primary">Resolve</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Demo data
    const reported = [
      {id:1,user:"playerAlice", text:"DM ignored safety concerns repeatedly during session.", reportedBy:"playerBob", status:"reported"},
      {id:2,user:"playerCharlie", text:"Review: 'This DM is the worst — rude and unprofessional.'", reportedBy:"playerDana", status:"reported"},
      {id:3,user:"playerEve", text:"Report: possible harassment in chat logs.", reportedBy:"playerFrank", status:"reported"},
      {id:4,user:"playerGus", text:"'Scammed me out of my item' — claims campaign owner asked for payment off-platform.", reportedBy:"playerHelen", status:"reported"},
      {id:5,user:"playerIvy", text:"Contains potentially identifying info posted by reviewer.", reportedBy:"playerJack", status:"reported"}
    ];

    const offensiveFraud = [
      {id:11, user:"reviewer1", text:"You are so incompetent and ruin games.", type:"offensive"},
      {id:12, user:"bot_user_42", text:"Great DM! (bought review) - contact spam@example.com", type:"fraudulent"},
      {id:13, user:"reviewer2", text:"This campaign is trash and the DM is an idiot.", type:"offensive"},
      {id:14, user:"suspiciousAcct", text:"Five star review but account created 2 minutes ago, identical text across campaigns.", type:"fraudulent"},
      {id:15, user:"reviewer3", text:"Contains explicit language but not hateful; user asked to remove others.", type:"offensive"}
    ];

    const disputes = [
      {id:21, players:"playerA vs DM-Z", summary:"Player says DM kicked them without warning; DM says rules violated.", transcript:"Player: I was kicked without warning.\nDM: You were repeatedly breaking session rules.\nPlayer: I asked twice for clarification.\nDM: You ignored the table rules."},
      {id:22, players:"playerB vs DM-Q", summary:"Player claims refund requested for paid session; DM refuses.", transcript:"Player: I paid and session never happened.\nDM: I canceled due to low attendance and refunded other players.\nPlayer: I never got a refund."},
      {id:23, players:"playerC vs DM-Y", summary:"Dispute over review content that accuses DM of cheating.", transcript:"Player: DM cheated during combat.\nDM: I used hidden rolls per rules.\nPlayer: You didn't disclose."},
      {id:24, players:"playerD vs DM-X", summary:"Accusation of sharing private player info.", transcript:"Player: The DM shared my message publicly.\nDM: That was unintentional and I edited it out.\nPlayer: Still unacceptable."},
      {id:25, players:"playerE vs DM-W", summary:"Player claims DM pressured for off-platform payment.", transcript:"Player: DM asked for payment outside site.\nDM: I offered optional material for purchase; I did not pressure."}
    ];

 // render helpers
    function createReportedItem(r) {
      const div = document.createElement('div');
      div.className = 'list-group-item d-flex justify-content-between align-items-start';
      div.id = 'rep-'+r.id;
      div.innerHTML = `
        <div>
          <div><strong>${escapeHtml(r.user)}</strong> — <span class="text-muted small">reported by ${escapeHtml(r.reportedBy)}</span></div>
          <div class="mt-1">${escapeHtml(r.text)}</div>
        </div>
        <div class="text-end">
          <button class="btn btn-sm btn-outline-secondary mb-1 me-1" data-action="dismiss">Dismiss</button>
          <button class="btn btn-sm btn-outline-success mb-1 me-1" data-action="resolve">Mark Resolved</button>
          <button class="btn btn-sm btn-outline-danger mb-1" data-action="remove">Remove</button>
        </div>
      `;
      attachReportedHandlers(div, r);
      return div;
    }

    function createOffenseItem(o) {
      const div = document.createElement('div');
      div.className = 'list-group-item d-flex justify-content-between align-items-start';
      div.id = 'off-'+o.id;
      const tag = o.type === 'fraudulent' ? '<span class="badge badge-fraud me-2">Fraud</span>' : '<span class="badge bg-warning text-dark me-2">Offensive</span>';
      div.innerHTML = `
        <div>
          <div>${tag}<strong>${escapeHtml(o.user)}</strong></div>
          <div class="mt-1">${escapeHtml(o.text)}</div>
        </div>
        <div class="text-end">
          <button class="btn btn-sm btn-outline-danger mb-1 me-1" data-action="remove">Remove</button>
          <button class="btn btn-sm btn-outline-primary mb-1" data-action="flag">Flag</button>
        </div>
      `;
      attachOffenseHandlers(div, o);
      return div;
    }

    function createDisputeItem(d) {
      const div = document.createElement('div');
      div.className = 'list-group-item d-flex justify-content-between align-items-start';
      div.id = 'dis-'+d.id;
      div.innerHTML = `
        <div>
          <div><strong>${escapeHtml(d.players)}</strong> <span class="text-muted small">— ${escapeHtml(d.summary)}</span></div>
        </div>
        <div class="text-end">
          <button class="btn btn-sm btn-outline-primary" data-action="mediate">Mediate</button>
        </div>
      `;
      attachDisputeHandlers(div, d);
      return div;
    }

    // attach handlers
    function attachReportedHandlers(elem, data) {
      elem.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const action = btn.getAttribute('data-action');
          if (action === 'dismiss') {
            elem.remove();
            console.log('Dismissed report:', data);
          } else if (action === 'resolve') {
            elem.classList.add('resolved');
            console.log('Marked resolved:', data);
          } else if (action === 'remove') {
            if (confirm('Remove this review (demo)?')) {
              elem.remove();
              console.log('Removed reported review:', data);
            }
          }
        });
      });
    }

        function attachOffenseHandlers(elem, data) {
      elem.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const action = btn.getAttribute('data-action');
          if (action === 'remove') {
            if (confirm('Remove this content (demo)?')) {
              elem.remove();
              console.log('Removed content:', data);
            }
          } else if (action === 'flag') {
            btn.classList.add('btn-success');
            btn.textContent = 'Flagged';
            console.log('Flagged content for review:', data);
          }
        });
      });
    }

    function attachDisputeHandlers(elem, data) {
      elem.querySelector('button[data-action]').addEventListener('click', () => {
        openMediationModal(data);
      });
    }

    // modal mediation
    let currentMediation = null;
    function openMediationModal(d) {
      currentMediation = d;
      document.getElementById('mediationTranscript').textContent = d.transcript;
      document.getElementById('mediationOutcome').value = 'no-action';
      document.getElementById('notifyParties').checked = true;
      const modal = new bootstrap.Modal(document.getElementById('mediateModal'));
      modal.show();
    }

    document.getElementById('mediateResolveBtn').addEventListener('click', () => {
      const outcome = document.getElementById('mediationOutcome').value;
      const notify = document.getElementById('notifyParties').checked;
      console.log('Mediation resolved for', currentMediation, 'outcome:', outcome, 'notify:', notify);
      alert('Dispute resolved (demo): ' + outcome);
      // mark dispute item as resolved in list
      const el = document.getElementById('dis-'+currentMediation.id);
      if (el) {
        el.classList.add('resolved');
        el.querySelector('button[data-action]').textContent = 'Resolved';
        el.querySelector('button[data-action]').disabled = true;
      }
      bootstrap.Modal.getInstance(document.getElementById('mediateModal')).hide();
    });

     // render lists
    function renderAll() {
      const rep = document.getElementById('reportedReviews');
      rep.innerHTML = '';
      reported.forEach(r => rep.appendChild(createReportedItem(r)));

      const off = document.getElementById('offensiveFraudList');
      off.innerHTML = '';
      offensiveFraud.forEach(o => off.appendChild(createOffenseItem(o)));

      const dis = document.getElementById('disputeList');
      dis.innerHTML = '';
      disputes.forEach(d => dis.appendChild(createDisputeItem(d)));
    }

    // simple escape to avoid accidental HTML injection in demo
    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // initial render
    renderAll();
  </script>
</body>
</html>
